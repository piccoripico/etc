# PAD フロー手順 (月次レポート補助)

オンプレ BI / 会計システムからの追加データ取得や PDF 生成を行う Power Automate for desktop の例です。

1. **前処理**
   - 入力パラメータ (対象月、出力先パス、SharePoint ドキュメント URL) を受け取る。
   - ログ用フォルダと一時フォルダを作成。

2. **オンプレシステムからの抽出**
   - 既存の BI ポータルにサインインし、対象月フィルターを設定。
   - 表示テーブルを CSV としてエクスポート、またはスクレイピングでデータを抽出。
   - 取得したファイルを指定フォルダに保存し、ファイルパスを出力変数に格納。

3. **PDF 化 (任意)**
   - Excel で抽出済み CSV を開き、ページ設定と書式を整えるマクロを実行。
   - 「印刷」→「Microsoft Print to PDF」で PDF 出力。
   - 生成された PDF のフルパスを変数にセット。

4. **戻り値の構築**
   - 成功/失敗のステータス、ファイルパス (CSV/PDF)、補足メッセージを JSON 文字列で作成。
   - `Set Variable` アクションで `ResultJson` などの名前で返却。

5. **例外処理**
   - 例外発生時はスクリーンショットを取得し、エラーログとともに保存。
   - リトライ回数・待機時間を設定したループで安定化させる。

クラウドフローでは、`Run a flow built with Power Automate for desktop` アクションの出力として `ResultJson` を受け取り、SharePoint のログ リストへ書き戻してください。
