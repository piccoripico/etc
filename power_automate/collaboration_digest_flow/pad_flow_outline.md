# Power Automate for desktop フロー手順例 (Collaboration Digest)

クラウドフローから起動され、会議室/来訪者のオンプレ同期や掲示板への追記を行う想定の手順例です。UI レイアウト変更に備え、セレクタ管理とリトライを組み込んでください。

## 前提
- 受け取る入力例
  - `startOfDay`: 対象日 (クラウドフロー側で `yyyy-MM-ddT00:00:00` 形式)。
  - `calendar`: Outlook 予定の配列 (件名、開始、場所など)。
  - `channelId`: Teams チャネル ID。
- 出力例
  - `status`: `Success` / `Partial` / `Failed`
  - `syncedCount`: 同期した予定件数
  - `errorMessage`: 失敗時の説明

## 手順例
1. **前処理**: 変数初期化、ログ ファイルのパスを作成。既存のブラウザ/アプリのセッションをクリーンアップ。
2. **会議室管理システムへのログイン**: UI 要素キャプチャで ID/PW を入力し、トップ画面遷移を確認。失敗時は 3 回までリトライ。
3. **予定の反映**:
   - `calendar` の各予定について、会議室と時刻を入力し予約を登録/更新。
   - 競合や満席があればスクリーンショットを保存し、`errorMessage` に追記。
4. **来訪者受付システム登録 (任意)**: 来訪者情報を別システムに転記。入力フォームの検証エラーを検出し、再入力ロジックを用意。
5. **監査ログ出力**: 各処理結果を CSV/テキストに追記し、必要に応じてネットワークドライブや SharePoint 同期フォルダーに保存。
6. **戻り値の設定**: `status` と `syncedCount`、`errorMessage` を設定し、クラウドフローに返却。
7. **後処理**: アプリを正常終了し、ブラウザ キャッシュをクリア。例外時はスクリーンショットをアップロードして証跡を残す。

## ベストプラクティス
- UI 変更対策として、アンカー ベースのセレクタと待機条件 (要素が表示されるまで待機) を併用します。
- 業務時間外のメンテナンスを想定し、接続失敗時の待機→再試行→フォールバック (ログのみ) の流れを実装してください。
- フロー実行マシンのタイムゾーンとクラウド側のタイムゾーンを合わせ、日付のずれを防ぎます。
