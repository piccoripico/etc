# Power Automate for desktop フロー概要

クラウドフローから渡される検出結果をもとに、オンプレミス/レガシーのマスタシステムへデータ同期する UI フローの例です。

## 前提
- クラウドフローの **Run a flow built with Power Automate for desktop** から、`items` と `fixes` (missing/email/dates/duplicates) が入力として渡されます。
- 同期対象アプリは WinForms または Web ブラウザで操作できることを想定しています。

## 推奨パラメータ
- **接続情報**: VPN/プロキシ/認証方式を環境変数または安全な入力として受け取る。
- **再試行回数**: UI 変更やネットワーク遅延に備え、重要ステップで 2〜3 回のリトライを設定。
- **ログ出力**: 主要な入力値と取得した伝票番号・エラー内容を JSON で返却。

## 例: マスタ同期の手順
1. 起動 & ログイン
   - アプリまたはブラウザを起動し、資格情報を安全なストレージから取得してログイン。
2. 修正済みデータの適用
   - `items` 配列を For each で回し、必要なフィールドを入力。
   - `fixes` の内容を参照し、欠損/メール/日付/重複の修正後値を優先的に登録。
3. 保存と確認
   - レコード保存後、確認ダイアログやトースト通知を待機。
   - 発行されたキー (例: マスタ ID) を取得し、返却用コレクションに追加。
4. エラー処理
   - 失敗時はスクリーンショットを取得し、例外メッセージを付与。
   - リトライが尽きた場合は `status = Failed` として戻り値に含める。
5. 返却
   - 返却値として `status`, `syncedCount`, `details` (ID/メッセージ) を JSON でクラウドフローへ返す。

## 留意事項
- 画面セレクタは安定要素 (AutomationId, name) を優先し、UI 変更に備えて複数候補を保持してください。
- クリップボード/キー送信を多用する場合は、入力フォーカスの確認ステップを挿入してください。
- 大量件数の同期はバッチサイズを設定し、途中結果をクラウドフローのログリストに段階保存することを推奨します。
